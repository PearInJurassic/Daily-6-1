<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.daily.dao.PostDao">
	<select id="queryPost" resultType="com.daily.entity.Post">
		SELECT *
		FROM tb_post
		ORDER BY post_update_time DESC
	</select>
	<select id="queryPostByUserId" resultType="com.daily.entity.Post">
		SELECT *
		FROM tb_post
		WHERE
		user_id=#{userId} and anonym=0
		ORDER BY post_update_time DESC
		LIMIT 5
	</select>
	<select id="queryUserByPostId" resultType="java.lang.Integer">
		SELECT user_id
		FROM tb_post
		WHERE
		post_id=#{postId}
	</select>
	
	<select id="queryPostByPostId" resultType="com.daily.entity.Post">
		SELECT *
		FROM tb_post
		WHERE
		post_id=#{postId}
	</select>
	
	<select id="queryPostByAreaId" resultType="com.daily.entity.Post">
		SELECT *
		FROM tb_post
		WHERE
		area_id=#{areaId}
	</select>
	
	
	<select id="queryRequireAuditPost" resultType="com.daily.entity.Post">
		SELECT *
		FROM tb_post
		WHERE
		tipoff_num > 5
	</select>
	
	<select id="queryPostByContent" resultType="com.daily.entity.Post">
		SELECT *
		FROM tb_post
		WHERE
		post_content like '%${str}%'
		
	</select>
	
	<select id="queryPostByContentAndUserId" resultType="com.daily.entity.Post">
		SELECT *
		FROM tb_post
		WHERE
		post_content like '%${str}%' AND user_id=#{userId}
		
	</select>
	
	<select id="queryAreaByContent" resultType="java.lang.Integer">
		SELECT area_id
		FROM tb_post
		WHERE
		post_content like '%${str}%'
		
	</select>
	
	<select id="queryLastPost" resultType="com.daily.entity.Post">
		SELECT *
		FROM tb_post
		order by post_id
		DESC Limit 1
		
	</select>
	
	<insert id="insertPost" useGeneratedKeys="true" keyProperty="postId"
		keyColumn="post_id" parameterType="com.daily.entity.Post">
		INSERT INTO
		tb_post(post_create_time,post_update_time,post_content,anonym,area_id,
		user_id,forward_post_id)
		VALUES
		(#{postCreateTime},#{postUpdateTime},#{postContent},#{anonym},#{areaId},
		#{userId},#{forwardPostId})
	</insert>
	<update id="updatePost" parameterType="com.daily.entity.Post">
		update tb_post
		<set>
			<if test="postContent != null">post_content=#{postContent},</if>
			<if test="postImg != null">post_img=#{postImg},</if>
			<if test="anonym != null">anonym=#{anonym},</if>
			<if test="postUpdateTime != null">post_update_time=#{postUpdateTime}</if>
		</set>
		where post_id=#{postId}
	</update>
	<delete id="deletePost">
		DELETE FROM
		tb_post
		WHERE
		post_id =
		#{postId}
	</delete>
	<update id="incCommentNum" parameterType="com.daily.entity.Post">
		update tb_post
		<set>
			 
			comment_num=comment_num + 1
		</set>
		where post_id=#{postId}
	</update>
	<update id="decCommentNum" parameterType="com.daily.entity.Post">
		update tb_post
		<set>
			 
			comment_num=comment_num - 1
		</set>
		where post_id=#{postId}
	</update>
	<select id="queryCommentNum" resultType="java.lang.Integer">
		SELECT comment_num
		FROM tb_post
		WHERE
		post_id=#{postId}
	</select>
	<update id="incLikeNum" parameterType="com.daily.entity.Post">
		update tb_post
		<set>
			 
			like_num=like_num + 1
		</set>
		where post_id=#{postId}
	</update>
	<update id="decLikeNum" parameterType="com.daily.entity.Post">
		update tb_post
		<set>
			 
			like_num=like_num - 1
		</set>
		where post_id=#{postId}
	</update>
	<select id="queryLikeNum" resultType="java.lang.Integer">
		SELECT like_num
		FROM tb_post
		WHERE
		post_id=#{postId}
	</select>
	
	<update id="incTipoffNum" parameterType="com.daily.entity.Post">
		update tb_post
		<set>
			 
			tipoff_num=tipoff_num + 1
		</set>
		where post_id=#{postId}
	</update>
	<update id="decTipoffNum" parameterType="com.daily.entity.Post">
		update tb_post
		<set>
			 
			tipoff_num=tipoff_num - 1
		</set>
		where post_id=#{postId}
	</update>
	<select id="queryTipoffNum" resultType="java.lang.Integer">
		SELECT tipoff_num
		FROM tb_post
		WHERE
		post_id=#{postId}
	</select>
	
	<update id="incForwardNum" parameterType="com.daily.entity.Post">
		update tb_post
		<set>
			 
			forward_num=forward_num + 1
		</set>
		where post_id=#{postId}
	</update>
	<update id="decForwardNum" parameterType="com.daily.entity.Post">
		update tb_post
		<set>
			 
			forward_num=forward_num - 1
		</set>
		where post_id=#{postId}
	</update>
	<select id="queryForwardNum" resultType="java.lang.Integer">
		SELECT forward_num
		FROM tb_post
		WHERE
		post_id=#{postId}
	</select>
	<select id="countPostNumByUserId" resultType="countPostNumByUserId">
		SELECT COUNT(*)
		FROM tb_post
		WHERE
		user_id=#{userId}
	</select>
</mapper>
    